{% extends 'base_attendee.html' %}

{% block content %}
<div class="dashboard-container">

    <h2 class="section-title">Your QR Code</h2>
    <div class="dashboard-section">
        {% if selected_event_qr %}
            <div class="card">
                <div class="card-header">
                    {{ selected_event_qr.event.name }}<br>
                    <span class="date">{{ selected_event_qr.event.date|date:"M d, Y" }}</span>
                </div>
                <div class="card-body">
                    {% if selected_event_qr.image %}
                        <img src="{{ selected_event_qr.image.url }}" alt="QR Code" class="qr-img">
                    {% else %}
                        <div class="alert alert-warning text-center">QR code image not found</div>
                    {% endif %}
                </div>
                <div class="card-footer">
                    {% if selected_event_qr.event.start_time and selected_event_qr.event.end_time %}
                        {{ selected_event_qr.event.start_time|time:"g:i A" }} - {{ selected_event_qr.event.end_time|time:"g:i A" }}
                    {% else %}
                        All day
                    {% endif %}
                </div>
            </div>
        {% else %}
            <div class="card mt-2">
                <div class="card-body text-center text-muted">
                    {% if selected_event %}
                        No QR code available for {{ selected_event.name }}. Please check back later or contact your facilitator.
                    {% else %}
                        Select an upcoming event to view its QR code.
                    {% endif %}
                </div>
            </div>
        {% endif %}
    </div>

    <h2 class="section-title">Your Upcoming Events</h2>
    <div class="dashboard-section">
        {% if upcoming_events %}
            {% for event in upcoming_events %}
                <div class="event-box {% if selected_event and selected_event.id == event.id %}active{% endif %}" 
                     data-event-id="{{ event.id }}">
                    <span>{{ event.name }} - {{ event.date|date:"M d, Y" }}</span>
                    <span class="event-time">
                        {% if event.start_time and event.end_time %}
                            {{ event.start_time|time:"g:i A" }} - {{ event.end_time|time:"g:i A" }}
                        {% else %}
                            All day
                        {% endif %}
                    </span>
                </div>
            {% endfor %}
        {% else %}
            <div class="event-box text-muted">
                <span>No upcoming events</span>
            </div>
        {% endif %}
    </div>

    <h2 class="section-title">Your Attendance History</h2>
    <div class="dashboard-section">
        {% if attendance_history %}
            {% for attendance in attendance_history %}
                <div class="attendance-box">
                    <span>{{ attendance.event.name }} - {{ attendance.event.date|date:"M d, Y" }}</span>
                    <span class="badge {% if attendance.status == 'present' %}bg-success{% elif attendance.status == 'late' %}bg-warning{% else %}absent{% endif %}">
                        {{ attendance.status|title }}
                    </span>
                </div>
            {% endfor %}
        {% else %}
            <div class="attendance-box text-muted">
                <span>No attendance records</span>
            </div>
        {% endif %}
    </div>

</div>

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const eventBoxes = document.querySelectorAll('.event-box');
    
    eventBoxes.forEach(box => {
        box.addEventListener('click', function() {
            const eventId = this.getAttribute('data-event-id');
            if (eventId) {
                const newUrl = new URL(window.location.href);
                newUrl.searchParams.set('event_id', eventId);
                window.location.href = newUrl.toString();
            }
        });
    });
});
</script>
{% endblock %}
{% endblock %}