{% load static %}

<!DOCTYPE html>
<html>
    <head>
        <title>SnapTrack</title>
        <link href="{% static 'css/mydesign.css' %}" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>
            function slidelogo() {
                document.getElementById('logo').classList.toggle('slide');
                document.getElementById('logo-img').classList.toggle('slide');
            }
        </script>
    </head>
    <body class="login-body">
        <div class="login-box">
            <div class="logo" id="logo">
                <img class="logo-img" id="logo-img" src="{% static 'images/logo-vertical.jpg' %}" width="200" height="200">
                <input class="btnlogin" type="button" value="Login" onclick="slidelogo()">
            </div>
            <div class="login">
                {% if form.errors %}
                    <div class="alert alert-danger">
                        Invalid username or password. Please try again.
                    </div>
                {% endif %}
                
                <form method="post" action="{% url 'eqrApp:login' %}{% if request.GET.next %}?next={{ request.GET.next }}{% endif %}">
                    {% csrf_token %}  <!-- This is crucial -->
                    <div class="login-username">
                        <input type="text" name="username" class="form-control" placeholder="ðŸ‘¤ Username" id="id_username" required autofocus>
                    </div>
                    <div class="login-password">
                        <input type="password" name="password" class="form-control" placeholder="ðŸ”’ Password" id="id_password" required>
                    </div>
                    <input type="hidden" name="next" value="{{ request.GET.next }}">
                    <div class="d-grid">
                        <button type="submit" class="btn-lg">Sign In</button>
                    </div>
                </form>
                </form>
            </div>
        </div>
    </body>
</html>

{% block extra_js %}
    {% if messages %}
      <div id="django-messages" style="display: none;">
        {% for message in messages %}
          <div data-icon="{{ message.tags|escapejs }}" data-text="{{ message|escapejs }}"></div>
        {% endfor %}
      </div>
    {% endif %}

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const container = document.getElementById("django-messages");
        if (container) {
          const messages = container.querySelectorAll("div[data-icon][data-text]");
          messages.forEach(el => {
            Swal.fire({
              icon: el.dataset.icon,
              text: el.dataset.text,
              timer: 3000,
              showConfirmButton: false,
              toast: true,
              position: 'top-end'
            });
          });
        }
      });
    </script>
{% endblock %}