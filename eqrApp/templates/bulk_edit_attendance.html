{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/bulk_edit.css' %}?v={{now|date:'U'}}">
{% endblock %}

{% block content %}
<div class="bulk_edit">
    <div class="edit-att-header">
        <div class="edit-att-back">
            <a href="{% url 'eqrApp:event_detail' event.id %}" class="edit-att-backbtn">
                <i class="fas fa-arrow-left"></i> Back
            </a>
        </div>
        <div>
            <h2 style="color: black;">
                <i class="fas fa-users-gear me-2"></i>  {{ event.name }}
            </h2>
        </div>
    </div>

    <div class="edit-box">
        <div class="name-nd-btns">
            <div class="allpresent">
                <button type="button" class="all-btns" id="setAllPresent">
                    <i class="fas fa-check"></i> Mark All Present
                </button>
            </div>
            <div>
                <h3>
                    <i class="fas fa-edit me-2"></i>  Edit Attendance Status
                </h3>
            </div>
            <div class="allabsent">
                <button type="button" class="all-btns" id="setAllAbsent">
                    <i class="fas fa-times"></i> Mark All Absent
                </button>
            </div>
        </div>
        <div class="edit-details">
            <form id="bulkAttendanceForm" method="post" action="{% url 'eqrApp:save_bulk_attendance' event.id %}">
                {% csrf_token %}
                <div class="table-box">
                    <table class="edit-attend-tbl">
                        <thead class="">
                            <tr>
                                <th>Name</th>
                                <th>Section</th>
                                <th class="">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for member in members %}
                            <tr>
                                <td>{{ member.get_full_name }}</td>
                                <td>{{ member.section|default:"-" }}</td>
                                <td>
                                    <div class="">
                                        <div class="" role="group">
                                            <input type="radio" class="" name="status_{{ member.member_id }}" 
                                                   id="present_{{ member.member_id }}" value="present"
                                                   {% if member.attendance_status == 'present' %}checked{% endif %}>
                                            <label class="m" for="present_{{ member.member_id }}">
                                                Present
                                            </label>
                                            
                                            <input type="radio" class="" name="status_{{ member.member_id }}"
                                                   id="late_{{ member.member_id }}" value="late"
                                                   {% if member.attendance_status == 'late' %}checked{% endif %}>
                                            <label class="" for="late_{{ member.member_id }}">
                                                Late
                                            </label>
                                            
                                            <input type="radio" class="" name="status_{{ member.member_id }}"
                                                   id="absent_{{ member.member_id }}" value="absent"
                                                   {% if member.attendance_status == 'absent' %}checked{% endif %}>
                                            <label class="" for="absent_{{ member.member_id }}">
                                                Absent
                                            </label>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="3" class="">
                                    No attendees found. <a href="{% url 'add_member' %}">Add your first attendee</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="save-btn">
                    <button type="submit" class="all-btns">
                        <i class="fas fa-save me-2"></i>  Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('setAllPresent').addEventListener('click', function() {
        document.querySelectorAll('input[id^="present_"]').forEach(radio => {
            radio.checked = true;
        });
    });
    
    document.getElementById('setAllAbsent').addEventListener('click', function() {
        document.querySelectorAll('input[id^="absent_"]').forEach(radio => {
            radio.checked = true;
        });
    });
});
</script>
{% endblock %} 
